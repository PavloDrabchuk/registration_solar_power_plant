<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:form="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script>
    function g() {
        console.log("click");
        return false;
    }

    function checkMatchingPasswords() {
        console.log(document.getElementById("password").value);
        console.log(document.getElementById("password_confirm").value);
        const password = document.getElementById("password").value;
        const passwordConfirm = document.getElementById("password_confirm").value;

        if (password !== "" && passwordConfirm !== "") {
            document.getElementById("matching_passwords").innerText = password !== passwordConfirm ? "Паролі не співпадають." : "";
        }
    }

    function checkFields() {
        let countErrors = 0;

        const username = document.getElementById("username").value,
            email = document.getElementById("email").value,
            password = document.getElementById("password").value,
            passwordConfirm = document.getElementById("password_confirm").value;

        if (username.length === 0) {
            countErrors++;
            document.getElementById("username_error").innerText="Введіть ім'я користувача.";
        } else {
            document.getElementById("username_error").innerText="";
        }
        if (email.length === 0) {
            countErrors++;
            document.getElementById("email_error").innerText="Введіть адресу електронної пошти.";
        } else {
            document.getElementById("email_error").innerText="";
        }

        if (password.length === 0) {
            countErrors++;
            document.getElementById("password_error").innerText="Введіть пароль";
        } else {
            document.getElementById("password_error").innerText="";
        }

        if(password!==passwordConfirm){
            countErrors++;
        }

        return countErrors === 0;
    }
</script>


<h1>Add new user</h1>

<h1>Form</h1>
<form action="add" th:action="@{/add}" th:object="${user}" method="post">

    <p>username: <input type="text" th:field="*{username}" id="username"/>
    <div th:if="${duplicateUser}" th:text="${duplicateUser}"></div>
    <div id="username_error"></div>
    </p>


    <p>e-mail: <input type="email" th:field="*{email}" id="email"/>
    <div th:if="${duplicateEmail}" th:text="${duplicateEmail}"></div>
    <div id="email_error"></div>
    <td th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Name Error</td>
    </p>

    <p>password: <input type="text" th:field="*{password}" id="password" onblur="checkMatchingPasswords()"/></p>
    <div id="password_error"></div>

    <p>password confirm: <input type="text" th:field="*{passwordConfirm}" id="password_confirm"
                                onblur="checkMatchingPasswords()"/></p>

    <div id="matching_passwords"></div>


    <td th:if="${#fields.hasErrors('passwordConfirm')}" th:errors="*{passwordConfirm}">Name Error</td>

    <p><input type="submit" value="add" onclick="return checkFields()"/> <input type="reset" value="Reset"/></p>
</form>

<div th:if="${qwe}">
    <h3 th:text="${qwe}"></h3>
</div>

<hr/>
</body>
</html>